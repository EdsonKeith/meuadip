<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel Administrativo - ADIP</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <nav>
            <div class="logo-container">
                <img src="Logotipo Monograma Minimalista Cinza e Preto_20250214_185236_0000.png" alt="Logo ADIP" class="nav-logo">
                <span class="logo-text">Apoio ao Imigrante</span>
            </div>
            <div class="nav-container">
                <button class="hamburger" aria-label="Menu de Navegação">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                <ul class="nav-menu">
                    <li><a href="index.html" class="btn btn-secondary">Voltar à Página Principal</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <main>
        <section class="admin-dashboard">
            <div class="container">
                <h1>Painel Administrativo</h1>

                <div class="dashboard-grid">
                    <div class="dashboard-card associates-management">
                        <h2>Gestão de Associados</h2>
                        <div class="associate-filters">
                            <input type="text" id="associateSearch" placeholder="Pesquisar associados...">
                            <select id="statusFilter">
                                <option value="">Todos os Status</option>
                                <option value="Pendente">Pendente</option>
                                <option value="Aprovado">Aprovado</option>
                                <option value="Rejeitado">Rejeitado</option>
                            </select>
                            <select id="nationalityFilter">
                                <option value="">Todas as Nacionalidades</option>
                                <option value="Brasil">Brasil</option>
                                <option value="Angola">Angola</option>
                                <option value="Moçambique">Moçambique</option>
                                <option value="Cabo Verde">Cabo Verde</option>
                                <option value="Guiné-Bissau">Guiné-Bissau</option>
                                <option value="São Tomé e Príncipe">São Tomé e Príncipe</option>
                            </select>
                        </div>
                        
                        <div id="associatesList" class="associates-list">
                            <div class="associate-row">
                                <span>Número</span>
                                <span>Nome</span>
                                <span>Email</span>
                                <span>Data de Nascimento</span>
                                <span>Nacionalidade</span>
                                <span>Data de Cadastro</span>
                                <span>Status</span>
                                <span>Ações</span>
                            </div>
                            <!-- Associates will be dynamically populated here -->
                        </div>

                        <div class="associate-actions">
                            <button id="exportAssociatesCSV" class="btn btn-secondary">Exportar CSV</button>
                            <button id="exportAssociatesPDF" class="btn btn-tertiary">Exportar PDF</button>
                        </div>
                    </div>

                    <div class="dashboard-card">
                        <h2>Métricas</h2>
                        <div id="dashboardMetrics">
                            <p>Total de Associados: <span id="totalAssociates">-</span></p>
                            <p>Novos Associados este Mês: <span id="newAssociatesThisMonth">-</span></p>
                        </div>
                    </div>
                </div>

                <div class="dashboard-card news-management">
                    <h2>Notícias</h2>
                    <div class="news-actions">
                        <button id="openNewsModal" class="btn btn-primary">Adicionar Nova Notícia</button>
                    </div>
                    <div id="newsList" class="news-list">
                        <!-- News will be dynamically populated here -->
                    </div>
                </div>

                <div class="dashboard-card events-management">
                    <h2>Gestão de Eventos</h2>
                    <div class="events-actions">
                        <button id="openEventModal" class="btn btn-primary">Adicionar Novo Evento</button>
                    </div>
                    <div id="eventManagementList" class="events-management-list">
                        <!-- Events will be dynamically populated here -->
                    </div>
                </div>

                <div class="dashboard-card opportunities-management">
                    <h2>Gestão de Oportunidades</h2>
                    <div class="opportunities-actions">
                        <button id="openOpportunityModal" class="btn btn-primary">Adicionar Nova Oportunidade</button>
                    </div>
                    <div id="opportunitiesManagementList" class="opportunities-management-list">
                        <!-- Opportunities will be dynamically populated here -->
                    </div>
                </div>
            </div>
        </section>

        <div id="newsModal" class="modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h2 id="newsModalTitle">Adicionar Nova Notícia</h2>
                <form id="newsForm">
                    <input type="hidden" id="newsId" name="newsId">
                    <input type="text" id="newsTitle" name="newsTitle" placeholder="Título da Notícia" required>
                    <textarea id="newsSummary" name="newsSummary" placeholder="Resumo da Notícia" required></textarea>
                    <textarea id="newsContent" name="newsContent" placeholder="Conteúdo Completo" required></textarea>
                    <input type="file" id="newsImage" name="newsImage" accept="image/*">
                    <button type="submit" class="btn btn-submit">Salvar Notícia</button>
                </form>
            </div>
        </div>

        <div id="eventModal" class="modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h2 id="eventModalTitle">Adicionar Novo Evento</h2>
                <form id="eventForm">
                    <input type="hidden" id="eventId" name="eventId">
                    <div class="form-group">
                        <label for="eventTitle">Título do Evento</label>
                        <input type="text" id="eventTitle" name="eventTitle" required>
                    </div>
                    <div class="form-group">
                        <label for="eventDescription">Descrição</label>
                        <textarea id="eventDescription" name="eventDescription" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="eventDate">Data do Evento</label>
                        <input type="datetime-local" id="eventDate" name="eventDate" required>
                    </div>
                    <div class="form-group">
                        <label for="eventLocation">Local</label>
                        <input type="text" id="eventLocation" name="eventLocation" required>
                    </div>
                    <div class="form-group">
                        <label for="eventImage">Imagem do Evento (Opcional)</label>
                        <input type="file" id="eventImage" name="eventImage" accept="image/*">
                    </div>
                    <button type="submit" class="btn btn-submit">Salvar Evento</button>
                </form>
            </div>
        </div>

        <div id="opportunityModal" class="modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h2 id="opportunityModalTitle">Adicionar Nova Oportunidade</h2>
                <form id="opportunityForm">
                    <input type="hidden" id="opportunityId" name="opportunityId">
                    <div class="form-group">
                        <label for="opportunityTitle">Título da Oportunidade</label>
                        <input type="text" id="opportunityTitle" name="opportunityTitle" required>
                    </div>
                    <div class="form-group">
                        <label for="opportunityDescription">Descrição</label>
                        <textarea id="opportunityDescription" name="opportunityDescription" required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="opportunityType">Tipo de Oportunidade</label>
                        <select id="opportunityType" name="opportunityType" required>
                            <option value="">Selecione o Tipo</option>
                            <option value="Emprego">Emprego</option>
                            <option value="Formação">Formação</option>
                            <option value="Apoio Social">Apoio Social</option>
                            <option value="Outro">Outro</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="opportunityContact">Link ou Contato</label>
                        <input type="text" id="opportunityContact" name="opportunityContact" required>
                    </div>
                    <div class="form-group">
                        <label for="validUntil">Data de Validade (Opcional)</label>
                        <input type="date" id="validUntil" name="validUntil">
                    </div>
                    <div class="form-group">
                        <label for="opportunityImage">Imagem (Opcional)</label>
                        <input type="file" id="opportunityImage" name="opportunityImage" accept="image/*">
                    </div>
                    <button type="submit" class="btn btn-submit">Salvar Oportunidade</button>
                </form>
            </div>
        </div>

        <div id="editAssociateModal" class="modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h2>Editar Associado</h2>
                <form id="editAssociateForm">
                    <input type="hidden" id="editAssociateId" name="editAssociateId">
                    
                    <div class="form-group">
                        <label for="editNome">Nome Completo</label>
                        <input type="text" id="editNome" name="editNome" required>
                    </div>

                    <div class="form-group">
                        <label for="editEmail">E-mail</label>
                        <input type="email" id="editEmail" name="editEmail" required>
                    </div>

                    <div class="form-group">
                        <label for="editTelefone">Telefone</label>
                        <input type="tel" id="editTelefone" name="editTelefone" required>
                    </div>

                    <div class="form-group">
                        <label for="editIdentificacao">Número de Identificação</label>
                        <input type="text" id="editIdentificacao" name="editIdentificacao" required>
                    </div>

                    <div class="form-group">
                        <label for="editDataNascimento">Data de Nascimento</label>
                        <input 
                            type="date" 
                            id="editDataNascimento" 
                            name="editDataNascimento" 
                            required
                            max="2005-01-01"  
                            data-error="Por favor, insira uma data de nascimento válida"
                        >
                        <span class="error-message"></span>
                    </div>

                    <div class="form-group">
                        <label for="editEndereco">Endereço</label>
                        <textarea id="editEndereco" name="editEndereco" required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="editNacionalidade">Nacionalidade</label>
                        <select id="editNacionalidade" name="editNacionalidade" required>
                            <option value="Brasil">Brasil</option>
                            <option value="Angola">Angola</option>
                            <option value="Moçambique">Moçambique</option>
                            <option value="Cabo Verde">Cabo Verde</option>
                            <option value="Guiné-Bissau">Guiné-Bissau</option>
                            <option value="São Tomé e Príncipe">São Tomé e Príncipe</option>
                            <option value="Outro">Outro</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="editStatus">Status</label>
                        <select id="editStatus" name="editStatus" required>
                            <option value="Pendente">Pendente</option>
                            <option value="Aprovado">Aprovado</option>
                            <option value="Rejeitado">Rejeitado</option>
                        </select>
                    </div>

                    <button type="submit" class="btn btn-submit">Salvar Alterações</button>
                </form>
            </div>
        </div>
    </main>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="contact-info">
                    <img src="Cartão de Identificação a Amarelo e Preto com Ilustração para Cartão de Sóc_20250209_150956_0000 (3).png" alt="Logo ADIP" class="footer-logo">
                    <h4>Contacte-nos</h4>
                    <p> +351 926 479 393</p>
                    <p> R. Prof. Egas Moniz 24A, 2845-340 Amora</p>
                    <p> associacaoadep@hotmail.com</p>
                    <p>&copy; 2025 ADIP - Todos os direitos reservados</p>
                    <div class="social-links">
                        <a href="https://www.facebook.com/associacaoadep" target="_blank">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                <path d="M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm3 8h-1.35c-.538 0-.65.221-.65.778v1.222h2l-.209 2h-1.791v7h-3v-7h-2v-2h2v-2.308c0-1.769.931-2.692 3.029-2.692h1.971v3z"/>
                            </svg>
                        </a>
                        <a href="https://www.instagram.com/associacaoadep" target="_blank">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                                <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.148 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.148-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.948-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.441 1.441 1.441c.795 0 1.439-.646 1.439-1.441s-.644-1.44-1.439-1.44z"/>
                            </svg>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    <script type="module" src="app.js"></script>
    <script type="module">
        import { 
          getFirestore, 
          collection, 
          query, 
          where, 
          getDocs,
          updateDoc,
          deleteDoc,
          doc,
          getDoc
        } from 'https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js';
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js';

        const firebaseConfig = {
          // Your Firebase configuration
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        async function loadAssociates(filter = {}) {
          const associatesList = document.getElementById('associatesList');
          associatesList.innerHTML = ''; // Clear previous results

          let associatesQuery = query(collection(db, 'associados'));

          // Apply filters if provided
          if (filter.status) {
            associatesQuery = query(associatesQuery, where('status', '==', filter.status));
          }
          if (filter.nacionalidade) {
            associatesQuery = query(associatesQuery, where('nacionalidade', '==', filter.nacionalidade));
          }

          const snapshot = await getDocs(associatesQuery);

          snapshot.forEach((docSnapshot) => {
            const associate = { id: docSnapshot.id, ...docSnapshot.data() };
            const row = document.createElement('div');
            row.classList.add('associate-row');
            row.innerHTML = `
              <span>${associate.associateNumber}</span>
              <span>${associate.nome}</span>
              <span>${associate.email}</span>
              <span>${new Date(associate.dataNascimento).toLocaleDateString()}</span>
              <span>${associate.nacionalidade}</span>
              <span>${new Date(associate.dataCadastro).toLocaleDateString()}</span>
              <span>${associate.status}</span>
              <span>
                <button onclick="editAssociate('${associate.id}')">Editar</button>
                <button onclick="deleteAssociate('${associate.id}')">Eliminar</button>
              </span>
            `;
            associatesList.appendChild(row);
          });
        }

        window.editAssociate = async (id) => {
          const associateDoc = await getDoc(doc(db, 'associados', id));
          const associate = associateDoc.data();

          // Populate edit modal
          document.getElementById('editNome').value = associate.nome;
          document.getElementById('editEmail').value = associate.email;
          document.getElementById('editStatus').value = associate.status;

          // Show edit modal
          document.getElementById('editAssociateModal').style.display = 'block';
        };

        window.deleteAssociate = async (id) => {
          if (confirm('Tem certeza que deseja eliminar este associado?')) {
            await deleteDoc(doc(db, 'associados', id));
            loadAssociates(); // Refresh list
          }
        };

        document.addEventListener('DOMContentLoaded', () => {
          loadAssociates();

          // Filter event listeners
          document.getElementById('statusFilter').addEventListener('change', (e) => {
            loadAssociates({ status: e.target.value });
          });

          document.getElementById('nationalityFilter').addEventListener('change', (e) => {
            loadAssociates({ nacionalidade: e.target.value });
          });
        });
    </script>
</body>
</html>